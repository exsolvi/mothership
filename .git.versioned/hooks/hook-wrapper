#!/usr/bin/env bash
if [ ! $(git config core.bare) == true ]; then
  if [ $0 == x"post-receive" ]; then
    # We are running on server and should update scripts"
    PREV=$(pwd)
    TMP=$(mktemp -d)
    cd $TMP
    git clone $PREV fullrepos > /dev/null
    git checkout meta
    cp fullrepos/.git.versioned/hooks/* $PREV/hooks/
    chmod u+x $PREV/hooks/*
    cd $PREV
    rm -rf $TMP
  fi
  test -f $0 && $0.server
else
  if [ x$0 == x"pre-commit" ]; then
    echo "Pre commit"
    if [ -d .git.versioned ]; then
      cp .git.versioned/hooks/* .git/hooks/
      chmod u+x $PREV/hooks/*
    fi
  fi
  test -f $0.client && $0.client
fi
exit 0
